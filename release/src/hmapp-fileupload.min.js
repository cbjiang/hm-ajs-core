function fileUploadService(e,l,i,a,n){var o=a,s=null==n?"tempSystem":n;return{uploadFile:function(e,l,a,n,r){i.upload({url:o+s+"/"+e+"/upload",method:"POST",data:{file:l}}).then(function(e){"function"==typeof a&&a(e)},function(e){"function"==typeof n&&n(e)},function(e){"function"==typeof r&&r(e)})},deleteFile:function(i){var a=l.defer();return e({method:"POST",url:o+"temp/delete",data:{dir:i.dir,saveNames:i.saveName,systemName:i.systemName}}).success(function(e,l,i,n){a.resolve(e)}).error(function(e,l,i,n){a.reject(e)}),a.promise}}}function FileUploadUtil(){var e=[".png",".jpg",".jpeg",".bmp"],l=[".mp4",".rmvb",".avi",".flv"],i=[".zip",".rar"],a=[".doc",".docx",".pdf",".xls",".xlsx",".ppt",".pptx"];return{getTypeList:function(n){if(null!=n){for(var o=n.split(","),s=[],r=0;r<o.length;r++)switch(o[r]){case"image":s=s.concat(e);break;case"video":s=s.concat(l);break;case"document":s=s.concat(a);break;case"package":s=s.concat(i)}return s.join(",")}return""},getType:function(e){return"."+e.substring(e.lastIndexOf(".")+1)},fileSizeToBytes:function(e){if(null!=e){var l=e.split(" "),i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"].indexOf(l[1]);return-1!=i?l[0]*Math.pow(1e3,i):""}return""}}}angular.module("hm.fileupload",["ngFileUpload"]).filter("uriDecode",function(){return function(e){return decodeURI(e)}}),null!=hmappSystemConfig&&angular.module("hm.fileupload").constant("FILESERVICE",hmappSystemConfig.FILESERVICE).constant("FILESYSTEMNAME",hmappSystemConfig.FILESYSTEMNAME).constant("FILEDIRNAME",hmappSystemConfig.FILEDIRNAME),angular.module("hm.fileupload").service("fileUploadService",fileUploadService),fileUploadService.$inject=["$http","$q","Upload","FILESERVICE"],angular.module("hm.fileupload").directive("hmUploadFile",["$compile","$http","$window","fileUploadService","FILESERVICE","FILEDIRNAME",function(e,l,i,a,n,o){return{link:function(l,s,r){function f(e,i,n){var o={};o.fileName=e.name,null!=i&&null!=n?l[u].splice(i,1,o):l[u].push(o),a.uploadFile(p,e,function(e){if(null!=e.data){var l=e.data.result.content.list;if(null!=l)for(var i=0;i<l.length;i++)o.dir=l[i].dir,o.fileName=l[i].fileName,o.fileType=l[i].fileType,o.fileurl=l[i].fileurl,o.saveName=l[i].saveName,o.systemName=l[i].systemName;null!=n&&null!=n.fileurl&&a.deleteFile(n).then(function(){console.log("临时文件 删除成功")},function(){console.log("临时文件 删除失败")})}},function(e){console.log("临时文件 上传失败")},function(e){var l=parseInt(100*e.loaded/e.total);o.progress=l+"%",console.log("progress: "+l+"% "+e.config.data.file.name)})}var t=null,d=null,c=n,p=null==r.dir||""==r.dir?null==o||""==o?"tempFileDir":o:r.dir,u=r.list,v=parseInt(r.size),g=FileUploadUtil().getTypeList(r.accept),m=r.filesize,N=FileUploadUtil().fileSizeToBytes(m),y="fileupload_edit_"+u,h="fileupload_download_"+u,b="fileupload_delete_"+u;if(null!=u&&""!=u){var F='<div class="file-upload-bar"><div ng-repeat="file in {fileList}" class="file-upload-info"><div ng-if="file.saveName==null" class="file-upload-ing"><div class="file-progress"><div style="margin-top: 30px"><span>{{file.progress}}</span></div><div class="progress progress-striped active "><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: {{file.progress}}"></div></div></div></div><div ng-if="file.saveName!=null"><div ng-if="file.fileType==\'png\' || file.fileType==\'jpg\' || file.fileType==\'jpeg\' || file.fileType==\'bmp\'" class="file-type-img" style="background: url(\'{{file.fileurl==null?\'{fileHost}\'+file.saveName:file.fileurl}}\') #000 center no-repeat;"><span class="ng-binding">&nbsp;</span><div class="file-upload-menu file"><div class="menu-btn edit" ng-click="{editFuncName}(file)"></div><div class="menu-btn download" ng-click="{downloadFuncName}(file)"></div><div class="menu-btn del" ng-click="{delFuncName}(file)"></div></div></div><div ng-if="file.fileType!=\'png\' && file.fileType!=\'jpg\' && file.fileType!=\'jpeg\' && file.fileType!=\'bmp\'" class="file-type-file"><span class="ng-binding">{{file.fileType | uppercase}}</span><div class="file-upload-menu file"><div class="menu-btn edit" ng-click="{editFuncName}(file)"></div><div class="menu-btn download" ng-click="{downloadFuncName}(file)"></div><div class="menu-btn del" ng-click="{delFuncName}(file)"></div></div><div class="file-name">{{file.fileName | uriDecode}}</div></div></div></div><div class="file-upload-add"></div></div>';F=F.replace(/\{fileList}/g,u).replace("{fileHost}",c).replace(/\{editFuncName}/g,y).replace(/\{downloadFuncName}/g,h).replace(/\{delFuncName}/g,b),null!=l[u]&&l[u].length>0||(l[u]=[]);var E='<input class="hide" type="file" accept="{accept}">';E=null!=g?E.replace("{accept}",g):E.replace("{accept}","");var T=$(E).appendTo(s);T.on("click",function(e){T.val(""),e.stopPropagation()}),s.append(e(F)(l)),T.on("change",function(e){var i=t,a=d;if(t=null,d=null,null==i&&null==a&&l[u].length>=v)toastr.error("最多上传"+v+"个附件!","添加附件-失败");else{var n=e.target.files;console.log(n);for(var o=0;o<n.length;o++){var s=n[o];if(null!=g&&""!=g&&-1==g.split(",").indexOf(FileUploadUtil().getType(s.name)))return void toastr.error("请上传"+g.replace(/,/g," ")+"类型的附件!","添加附件-失败");if(null!=N&&""!=N&&s.size>N)return void toastr.error("上传的附件大小不能超过"+m+"!","添加附件-失败");f(s,i,a)}}}),s.find(".file-upload-add").on("click",function(){T.click()}),void 0===l[b]&&(l[b]=function(e){for(var i=0;i<l[u].length;i++)if(e.saveName==l[u][i].saveName){null!=e.fileurl?a.deleteFile(e).then(function(){l[u].splice(i,1),console.log("临时文件 删除成功")},function(){console.log("临时文件 删除失败")}):l[u].splice(i,1);break}}),void 0===l[h]&&(l[h]=function(e){for(var a=0;a<l[u].length;a++)if(e.saveName==l[u][a].saveName){null!=e.fileurl?i.location.href=e.fileurl:i.location.href=c+e.saveName;break}}),void 0===l[y]&&(l[y]=function(e){for(var i=0;i<l[u].length;i++)if(e.saveName==l[u][i].saveName){t=i,d=e,T.click();break}})}}}}]),angular.module("hm.fileupload").directive("hmUploadFileDetail",["$compile","$http","$window","fileUploadService","FILESERVICE","FILEDIRNAME",function(e,l,i,a,n,o){return{link:function(l,i,a){var o=n,s=(null==a.dir||""==a.dir||a.dir,a.list);if(null!=s&&""!=s){var r='<div class="file-upload-bar"><div ng-repeat="file in {fileList}" class="file-upload-info detail"><div ng-if="file.saveName!=null"><div ng-if="file.fileType==\'png\' || file.fileType==\'jpg\' || file.fileType==\'jpeg\' || file.fileType==\'bmp\'" class="file-type-img" style="background: url(\'{{file.fileurl==null?\'{fileHost}\'+file.saveName:file.fileurl}}\') #000 center no-repeat;"><span class="ng-binding">&nbsp;</span><div class="file-upload-menu file"></div></div><div ng-if="file.fileType!=\'png\' && file.fileType!=\'jpg\' && file.fileType!=\'jpeg\' && file.fileType!=\'bmp\'" class="file-type-file"><span class="ng-binding">{{file.fileType | uppercase}}</span><div class="file-upload-menu file"></div><div class="file-name">{{file.fileName | uriDecode}}</div></div></div></div></div>';r=r.replace(/\{fileList}/g,s).replace("{fileHost}",o),null!=l[s]&&l[s].length>0||(l[s]=[]),i.append(e(r)(l))}}}}]),angular.module("hm.fileupload").directive("hmUploadImage",["$compile","$http","$window","fileUploadService","FILESERVICE","FILEDIRNAME",function(e,l,i,a,n,o){return{link:function(l,s,r){function f(e,i,n){var o={};o.fileName=e.name,null!=i&&null!=n?l[u].splice(i,1,o):l[u].push(o),a.uploadFile(p,e,function(e){if(null!=e.data){var l=e.data.result.content.list;if(null!=l)for(var i=0;i<l.length;i++)o.dir=l[i].dir,o.fileName=l[i].fileName,o.fileType=l[i].fileType,o.fileurl=l[i].fileurl,o.saveName=l[i].saveName,o.systemName=l[i].systemName,o.isCover=0;null!=n&&null!=n.fileurl&&a.deleteFile(n).then(function(){console.log("临时文件 删除成功")},function(){console.log("临时文件 删除失败")})}},function(e){console.log("临时文件 上传失败")},function(e){var l=parseInt(100*e.loaded/e.total);o.progress=l+"%",console.log("progress: "+l+"% "+e.config.data.file.name)})}var t=null,d=null,c=n,p=null==r.dir||""==r.dir?null==o||""==o?"tempImgDir":o:r.dir,u=r.list,v=parseInt(r.size),g=FileUploadUtil().getTypeList("image"),m=r.filesize,N=FileUploadUtil().fileSizeToBytes(m),y="fileupload_cover_"+u,h="fileupload_edit_"+u,b="fileupload_download_"+u,F="fileupload_delete_"+u;if(null!=u&&""!=u){var E='<div class="file-upload-bar"><div ng-repeat="file in {fileList}" class="file-upload-info"><div ng-if="file.saveName==null" class="file-upload-ing"><div class="file-progress"><div style="margin-top: 30px"><span>{{file.progress}}</span></div><div class="progress progress-striped active "><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: {{file.progress}}"></div></div></div></div><div ng-if="file.saveName!=null"><div class="file-type-img" style="background: url(\'{{file.fileurl==null?\'{fileHost}\'+file.saveName:file.fileurl}}\') #000 center no-repeat;"><span class="ng-binding">&nbsp;</span><div class="file-upload-menu"><div class="menu-btn cover" ng-class="{\'active\':file.isCover==1}" ng-click="{coverFuncName}(file)"></div><div class="menu-btn edit" ng-click="{editFuncName}(file)"></div><div class="menu-btn download" ng-click="{downloadFuncName}(file)"></div><div class="menu-btn del" ng-click="{delFuncName}(file)"></div></div><div ng-if="file.isCover==1" class="cover-tab"></div></div></div></div><div class="file-upload-add image"></div></div>';E=E.replace(/\{fileList}/g,u).replace("{fileHost}",c).replace(/\{coverFuncName}/g,y).replace(/\{editFuncName}/g,h).replace(/\{downloadFuncName}/g,b).replace(/\{delFuncName}/g,F),null!=l[u]&&l[u].length>0||(l[u]=[]);var T='<input class="hide" type="file" accept="{accept}">';T=null!=g?T.replace("{accept}",g):T.replace("{accept}","");var I=$(T).appendTo(s);I.on("click",function(e){I.val(""),e.stopPropagation()}),s.append(e(E)(l)),I.on("change",function(e){var i=t,a=d;if(t=null,d=null,null==i&&null==a&&l[u].length>=v)toastr.error("最多上传"+v+"个附件!","添加附件-失败");else for(var n=e.target.files,o=0;o<n.length;o++){var s=n[o];if(null!=g&&""!=g&&-1==g.split(",").indexOf(FileUploadUtil().getType(s.name)))return void toastr.error("请上传"+g.replace(/,/g," ")+"类型的附件!","添加附件-失败");if(null!=N&&""!=N&&s.size>N)return void toastr.error("上传的附件大小不能超过"+m+"!","添加附件-失败");f(s,i,a)}}),s.find(".file-upload-add").on("click",function(){I.click()}),void 0===l[F]&&(l[F]=function(e){for(var i=0;i<l[u].length;i++)if(e.saveName==l[u][i].saveName){null!=e.fileurl?a.deleteFile(e).then(function(){l[u].splice(i,1),console.log("临时文件 删除成功")},function(){console.log("临时文件 删除失败")}):l[u].splice(i,1);break}}),void 0===l[b]&&(l[b]=function(e){for(var a=0;a<l[u].length;a++)if(e.saveName==l[u][a].saveName){null!=e.fileurl?i.location.href=e.fileurl:i.location.href=c+e.saveName;break}}),void 0===l[h]&&(l[h]=function(e){for(var i=0;i<l[u].length;i++)if(e.saveName==l[u][i].saveName){t=i,d=e,I.click();break}}),void 0===l[y]&&(l[y]=function(e){for(var i=0;i<l[u].length;i++)e.saveName==l[u][i].saveName?l[u][i].isCover=1:l[u][i].isCover=0})}}}}]),angular.module("hm.fileupload").directive("hmUploadImageDetail",["$compile","$http","$window","fileUploadService","FILESERVICE","FILEDIRNAME",function(e,l,i,a,n,o){return{link:function(l,i,a){var o=n,s=(null==a.dir||""==a.dir||a.dir,a.list);if(null!=s&&""!=s){var r='<div class="file-upload-bar"><div ng-repeat="file in {fileList}" class="file-upload-info detail"><div ng-if="file.saveName!=null"><div class="file-type-img" style="background: url(\'{{file.fileurl==null?\'{fileHost}\'+file.saveName:file.fileurl}}\') #000 center no-repeat;"><span class="ng-binding">&nbsp;</span><div class="file-upload-menu"></div><div ng-if="file.isCover==1" class="cover-tab"></div></div></div></div></div>';r=r.replace(/\{fileList}/g,s).replace("{fileHost}",o),null!=l[s]&&l[s].length>0||(l[s]=[]),i.append(e(r)(l))}}}}]);