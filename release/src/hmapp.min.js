function matchMenu(e){$("#jquery-accordion-menu").find("li").length>0?(Layout.setSidebarMenuActiveLink("match"),e()):setTimeout(function(){matchMenu(e)},100)}angular.module("hm.appcore",["ui.router","ui.bootstrap","oc.lazyLoad","ngSanitize","ngStorage"]),null!=hmappSystemConfig&&(angular.module("hm.appcore").constant("SYSNAME",hmappSystemConfig.SYSNAME),angular.module("hm.appcore").constant("SYSCODE",hmappSystemConfig.SYSCODE),angular.module("hm.appcore").constant("VERSION",hmappSystemConfig.VERSION),angular.module("hm.appcore").constant("GATEWAYURL",hmappSystemConfig.GATEWAYURL),angular.module("hm.appcore").constant("LOGINURL",hmappSystemConfig.LOGINURL)),angular.module("hm.appcore").constant("COMMONSTATE",[{name:"403",url:"/403.html",templateUrl:"hm/views/403.html",data:{pageTitle:"403 - 禁止访问: 访问被拒绝。"},controller:"",ocLazyLoad:{name:"hm.appcore",files:[]}},{name:"404",url:"/404.html",templateUrl:"hm/views/404.html",data:{pageTitle:"404 - 找不到文件或目录。"},controller:"",ocLazyLoad:{name:"hm.appcore",files:[]}},{name:"500",url:"/500.html",templateUrl:"hm/views/500.html",data:{pageTitle:"500 - 内部服务器错误。"},controller:"",ocLazyLoad:{name:"hm.appcore",files:[]}}]),angular.module("hm.appcore").factory("settings",["$rootScope",function(e){var a={layout:{pageSidebarClosed:!1,pageBodySolid:!0,pageAutoScrollOnLoad:1e3},layoutImgPath:"hm/img/",layoutCssPath:"hm/css/"};return e.settings=a,a}]),angular.module("hm.appcore").controller("AppController",["$scope","$rootScope",function(e,a){e.$on("$viewContentLoaded",function(){})}]),angular.module("hm.appcore").run(["$rootScope","settings","$state","$ocLazyLoad","$location","$localStorage","$sessionStorage","SYSNAME","LOGINURL",function(e,a,o,t,n,r,i,l,c){r.authenticationToken||i.authenticationToken||(window.location=n.protocol()+"://"+n.host()+":"+n.port()+"/"+l+"/"+c),t.load("hm.appcore"),e.$state=o}]),function(){"use strict";angular.module("hm.appcore").config(["$ocLazyLoadProvider","globalLazyLoad",function(e,a){e.config({debug:!0,events:!0,modules:[{name:"hm.appcore",insertBefore:"#ng_load_plugins_before",files:a.concat([])}]})}]),angular.module("hm.appcore").config(["$controllerProvider",function(e){e.allowGlobals()}]),angular.module("hm.appcore").config(["$stateProvider","$urlRouterProvider","STATECONFIG","COMMONSTATE",function(e,a,o,t){null!=o&&o.length>0&&(angular.forEach(o,function(a){e.state(a.name,{url:a.url,params:a.params,templateUrl:a.templateUrl,data:a.data,controller:a.controller,resolve:{deps:["$ocLazyLoad",function(e){return e.load($.extend({serie:!0},a.ocLazyLoad))}]}})}),angular.forEach(t,function(a){e.state(a.name,{url:a.url,params:a.params,templateUrl:a.templateUrl,data:a.data,controller:a.controller,resolve:{deps:["$ocLazyLoad",function(e){return e.load($.extend({serie:!0},a.ocLazyLoad))}]}})}))}]),angular.module("hm.appcore").provider("test",function(){console.log("instance test");var e=function(e){alert("Hello, "+e)};this.$get=function(){return e}})}(),angular.module("hm.appcore").directive("ngDoLogout",["$location","$localStorage","$sessionStorage",function(e,a,o){function t(){delete a.authenticationToken,delete o.authenticationToken,delete o.userInfo,window.location.reload()}return{link:function(e,a,o){a.bind("click",function(){t()})}}}]),angular.module("hm.appcore").directive("ngSpinnerBar",["$rootScope","$location","$localStorage","$sessionStorage","$state","SYSNAME","LOGINURL",function(e,a,o,t,n,r,i){return{link:function(n,l,c){l.addClass("hide"),e.$on("$stateChangeStart",function(){console.log("$stateChangeStart"),a.absUrl()!=i&&(o.authenticationToken||t.authenticationToken||(window.location=a.protocol()+"://"+a.host()+":"+a.port()+"/"+r+"/"+i)),l.removeClass("hide")}),e.$on("$stateChangeSuccess",function(){console.log("$stateChangeSuccess"),setTimeout(function(){matchMenu(function(){l.addClass("hide"),$("body").removeClass("page-on-load")})},1e3)}),e.$on("$stateNotFound",function(){l.addClass("hide")}),e.$on("$stateChangeError",function(){l.addClass("hide")})}}}]),angular.module("hm.appcore").directive("a",function(){return{restrict:"E",link:function(e,a,o){(o.ngClick||""===o.href||"#"===o.href)&&a.on("click",function(e){e.preventDefault()})}}}),angular.module("hm.appcore").directive("dropdownMenuHover",function(){return{link:function(e,a){a.dropdownHover()}}}),angular.module("hm.appcore").directive("ngPageUtil",["$compile",function(e){function a(o,t){t.empty();var n=o.page,r=o.total;if(null!=r){var i=o.size,l=Math.ceil(r/i),c="<p>当前显示<span>"+((n-1)*i+1)+"到"+(n*i>r?r:n*i)+"</span>条，共<span>"+r+"</span>条记录</p>";$(t[0]).append(c);var s='<li ng-class="{\'active\':page=={pageNum}}"><a ng-click="loadPage({page})">{pageStr}</a></li>',p='<li class="disabled"><a>...</a></li>',u='<li class="{disabled}"><a ng-click="loadPage({page})" aria-label="Previous"><span class="glyphicon glyphicon-triangle-left" aria-hidden="true"></span></a></li>',d='<li class="{disabled}"><a ng-click="loadPage({page})" aria-label="Next"><span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span></a></li>',g="";if(g+=1==n?u.replace("{disabled}","disabled").replace("{page}",1):u.replace("{disabled}","").replace("{page}",n-1),l<=7)for(var h=0;h<l;h++)g+=s.replace("{pageNum}",h+1).replace("{page}",h+1).replace("{pageStr}",h+1);else g+=s.replace("{pageNum}",1).replace("{page}",1).replace("{pageStr}",1),n<=4?(g+=s.replace("{pageNum}",2).replace("{page}",2).replace("{pageStr}",2),g+=s.replace("{pageNum}",3).replace("{page}",3).replace("{pageStr}",3),g+=s.replace("{pageNum}",4).replace("{page}",4).replace("{pageStr}",4),g+=s.replace("{pageNum}",5).replace("{page}",5).replace("{pageStr}",5),g+=p):n>=l-3?(g+=p,g+=s.replace("{pageNum}",l-4).replace("{page}",l-4).replace("{pageStr}",l-4),g+=s.replace("{pageNum}",l-3).replace("{page}",l-3).replace("{pageStr}",l-3),g+=s.replace("{pageNum}",l-2).replace("{page}",l-2).replace("{pageStr}",l-2),g+=s.replace("{pageNum}",l-1).replace("{page}",l-1).replace("{pageStr}",l-1)):(g+=p,g+=s.replace("{pageNum}",n-1).replace("{page}",n-1).replace("{pageStr}",n-1),g+=s.replace("{pageNum}",n).replace("{page}",n).replace("{pageStr}",n),g+=s.replace("{pageNum}",n+1).replace("{page}",n+1).replace("{pageStr}",n+1),g+=p),g+=s.replace("{pageNum}",l).replace("{page}",l).replace("{pageStr}",l);g+=n==l?d.replace("{disabled}","disabled").replace("{page}",l):d.replace("{disabled}","").replace("{page}",n+1),$(t[0]).append(e('<ul  class="pagination">'+g+"</ul>")(o)),t.find("li").on("click",function(){$(this).hasClass("disabled")||a(o,t)})}else setTimeout(function(){a(o,t)},100)}var o=[];return{link:function(e,t,n){a(e,t),o.push(e.$watch("total",function(e,o,n){a(n,t)})),e.$on("$destroy",function(){for(;o.length;)o.shift()()})}}}]),angular.module("hm.appcore").directive("ngGoBack",["$window",function(e){return{link:function(a,o,t){o.on("click",function(a){e.history.back(),a.stopPropagation()})}}}]),angular.module("hm.appcore").factory("hmState",["$state",function(e){return{go:function(a,o,t){$(".main-view").removeClass("active"),e.go(a,o),$(".child-view").addClass("active"),"function"==typeof t&&t()},back:function(e){$(".child-view").removeClass("active"),$(".main-view").addClass("active"),window.history.back(),"function"==typeof e&&e()}}}]),angular.module("hm.appcore").directive("hmStateGoBack",["$window",function(e){return{link:function(a,o,t){o.on("click",function(a){$(".child-view").removeClass("active"),$(".main-view").addClass("active"),e.history.back(),a.stopPropagation()})}}}]),angular.module("hm.appcore").directive("hmFormPoints",function(){return{require:"?ngModel",restrict:"A",scope:{ngModel:"="},link:function(e,a,o,t){t.$render=function(){a.val(t.$viewValue||"");var e=parseInt(t.$viewValue);l.find("li").slice(0,e).addClass("active")};for(var n=null==o.total?5:parseInt(o.total),r="",i=0;i<n;i++)r+='<li class="point-item"></li>';var l=angular.element('<ul class="point-bar">'+r+"</ul>");l.insertAfter(a),a.addClass("hide"),l.find("li").hover(function(){$(this).addClass("hover"),$(this).prevAll().addClass("hover")},function(){l.find("li").removeClass("hover")}),l.find("li").on("click",function(){l.find("li").removeClass("active"),$(this).addClass("active"),$(this).prevAll().addClass("active"),a.val($(this).prevAll().length+1).trigger("change")}),l.on("dblclick",function(){l.find("li").removeClass("active"),a.val(0).trigger("change")})}}}),angular.module("hm.appcore").directive("hmWordNum",function(){return{require:"?ngModel",restrict:"A",scope:{ngModel:"="},link:function(e,a,o,t){var n;console.log(t),t.$render=function(){a.val(t.$viewValue||""),n=$('<span style="position:absolute;top:'+(a.position().top+a.height()-20)+"px;left:"+(a.position().left+a.width()+20)+'px">'+(null==t.$viewValue?0:t.$viewValue.length)+"/"+o.hmWordNum+"</span>").appendTo("body")},a.on("keyup",function(){n.remove(),n=$('<span style="position:absolute;top:'+(a.position().top+a.height()-20)+"px;left:"+(a.position().left+a.width()+20)+'px">'+(null==t.$viewValue?0:t.$viewValue.length)+"/"+o.hmWordNum+"</span>").appendTo("body")}),a.on("resize",function(e){n.remove(),n=$('<span style="position:absolute;top:'+(a.position().top+a.height()-20)+"px;left:"+(a.position().left+a.width()+20)+'px">'+(null==t.$viewValue?0:t.$viewValue.length)+"/"+o.hmWordNum+"</span>").appendTo("body"),e.stopPropagation()}),a.parents().on("resize",function(e){n.remove(),n=$('<span style="position:absolute;top:'+(a.position().top+a.height()-20)+"px;left:"+(a.position().left+a.width()+20)+'px">'+(null==t.$viewValue?0:t.$viewValue.length)+"/"+o.hmWordNum+"</span>").appendTo("body"),e.stopPropagation()}),e.$on("$destroy",function(){console.log("destroy"),n.remove()})}}}),function(){"use strict";function e(e,a,o,t,n,r){function i(a){e({method:"GET",url:r+"hmmsuser/api/tb_users/queryMenu",params:{loginId:o.userInfo.loginId,sysKey:n},data:{}}).success(function(e,n,r,i){0==e.list.length&&($(".page-spinner-bar").removeClass("hide"),$("body").addClass("page-on-load"),toastr.error("您没有权限进入该系统!","登陆失败"),delete t.authenticationToken,delete o.authenticationToken,delete o.userInfo,setTimeout(function(){window.location.reload()},2e3)),a(e.list,n,r,i)}).error(function(e,o,t,n){a(e,o,t,n)})}function l(){var o=a.defer();return e({method:"GET",url:r+"hmmsuser/api/tb_user",params:{},data:{}}).success(function(e,a,t,n){o.resolve(e)}).error(function(e,a,t,n){o.reject(e)}),o.promise}return{getSidebarInfo:function(e){null==o.userInfo?l().then(function(a){o.userInfo=a,i(e)}):i(e)},getUserInfo:l,changeMyPassword:function(o,t){var n=a.defer();return e({method:"POST",url:r+"api/account/change_my_password",params:{},data:{password:o,oldPassword:t}}).success(function(e,a,o,t){n.resolve(e)}).error(function(e,a,o,t){n.reject(e)}),n.promise}}}angular.module("hm.appcore").service("hmappService",e),e.$inject=["$http","$q","$sessionStorage","$localStorage","SYSCODE","GATEWAYURL"]}();var Layout=function(){var e=function(e,a){var o=location.hash.toLowerCase(),t=$("#jquery-accordion-menu");if("click"===e||"set"===e)a=$(a);else if("match"===e){t.find("li > a");t.find("li > a").each(function(){var e=null==$(this).attr("href")?"":$(this).attr("href").toLowerCase();e.length>1&&o.substr(1,e.length-1)==e.substr(1)&&(a=$(this))})}a&&0!=a.size()&&"javascript:;"!==a.attr("href").toLowerCase()&&"#"!==a.attr("href").toLowerCase()&&(t.find("li.active").removeClass("active"),a.parents("li").each(function(){$(this).addClass("active"),$(this).find("> a").addClass("submenu-indicator-minus"),$(this).find("ul.submenu").size()>0&&$(this).find("ul.submenu").css("display","block")}))};return{setSidebarMenuActiveLink:function(a,o){e(a,o)}}}();!function(){"use strict";angular.module("hm.appcore").config(["$httpProvider",function(e){e.interceptors.push("authInterceptor"),e.interceptors.push("authExpiredInterceptor")}])}(),function(){"use strict";function e(e,a,o,t,n,r,i){return{request:function(e){e.headers=e.headers||{};var a=t.authenticationToken||n.authenticationToken;return a?e.headers.Authorization="Bearer "+a:window.location=o.protocol()+"://"+o.host()+":"+o.port()+"/"+r+"/"+i,e}}}angular.module("hm.appcore").factory("authInterceptor",e),e.$inject=["$rootScope","$q","$location","$localStorage","$sessionStorage","SYSNAME","LOGINURL"]}(),function(){"use strict";function e(e,a,o,t,n){return{responseError:function(e){return 401===e.status&&(delete t.authenticationToken,delete n.authenticationToken,delete n.userInfo,window.location.reload()),a.reject(e)}}}angular.module("hm.appcore").factory("authExpiredInterceptor",e),e.$inject=["$rootScope","$q","$injector","$localStorage","$sessionStorage"]}();