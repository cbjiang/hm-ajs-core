function matchMenu(e){$("#jquery-accordion-menu").find("li").length>0?(Layout.setSidebarMenuActiveLink("match"),e()):setTimeout(function(){matchMenu(e)},100)}angular.module("hm.appcore",["ui.router","ui.bootstrap","oc.lazyLoad","ngSanitize","ngStorage"]),null!=hmappSystemConfig&&(angular.module("hm.appcore").constant("SYSNAME",hmappSystemConfig.SYSNAME),angular.module("hm.appcore").constant("SYSCODE",hmappSystemConfig.SYSCODE),angular.module("hm.appcore").constant("VERSION",hmappSystemConfig.VERSION),angular.module("hm.appcore").constant("GATEWAYURL",hmappSystemConfig.GATEWAYURL),angular.module("hm.appcore").constant("LOGINURL",hmappSystemConfig.LOGINURL)),angular.module("hm.appcore").constant("COMMONSTATE",[{name:"403",url:"/403.html",templateUrl:"hm/views/403.html",data:{pageTitle:"403 - 禁止访问: 访问被拒绝。"},controller:"",ocLazyLoad:{name:"hm.appcore",files:[]}},{name:"404",url:"/404.html",templateUrl:"hm/views/404.html",data:{pageTitle:"404 - 找不到文件或目录。"},controller:"",ocLazyLoad:{name:"hm.appcore",files:[]}},{name:"500",url:"/500.html",templateUrl:"hm/views/500.html",data:{pageTitle:"500 - 内部服务器错误。"},controller:"",ocLazyLoad:{name:"hm.appcore",files:[]}}]),angular.module("hm.appcore").factory("settings",["$rootScope",function(e){var a={layout:{pageSidebarClosed:!1,pageBodySolid:!0,pageAutoScrollOnLoad:1e3},layoutImgPath:"hm/img/",layoutCssPath:"hm/css/"};return e.settings=a,a}]),angular.module("hm.appcore").controller("AppController",["$scope","$rootScope",function(e,a){e.$on("$viewContentLoaded",function(){})}]),angular.module("hm.appcore").run(["$rootScope","settings","$state","$ocLazyLoad","$location","$localStorage","$sessionStorage","SYSNAME","LOGINURL",function(e,a,t,o,n,r,l,i,c){r.authenticationToken||l.authenticationToken||(window.location=n.protocol()+"://"+n.host()+":"+n.port()+"/"+i+"/"+c),o.load("hm.appcore"),e.$state=t}]),function(){"use strict";angular.module("hm.appcore").config(["$ocLazyLoadProvider","globalLazyLoad",function(e,a){e.config({debug:!0,events:!0,modules:[{name:"hm.appcore",insertBefore:"#ng_load_plugins_before",files:a.concat([])}]})}]),angular.module("hm.appcore").config(["$controllerProvider",function(e){e.allowGlobals()}]),angular.module("hm.appcore").config(["$stateProvider","$urlRouterProvider","STATECONFIG","COMMONSTATE",function(e,a,t,o){null!=t&&t.length>0&&(angular.forEach(t,function(a){e.state(a.name,{url:a.url,params:a.params,templateUrl:a.templateUrl,data:a.data,controller:a.controller,resolve:{deps:["$ocLazyLoad",function(e){return e.load($.extend({serie:!0},a.ocLazyLoad))}]}})}),angular.forEach(o,function(a){e.state(a.name,{url:a.url,params:a.params,templateUrl:a.templateUrl,data:a.data,controller:a.controller,resolve:{deps:["$ocLazyLoad",function(e){return e.load($.extend({serie:!0},a.ocLazyLoad))}]}})}))}]),angular.module("hm.appcore").provider("test",function(){console.log("instance test");var e=function(e){alert("Hello, "+e)};this.$get=function(){return e}})}(),angular.module("hm.appcore").directive("ngDoLogout",["$location","$localStorage","$sessionStorage",function(e,a,t){function o(){delete a.authenticationToken,delete t.authenticationToken,delete t.userInfo,window.location.reload()}return{link:function(e,a,t){a.bind("click",function(){o()})}}}]),angular.module("hm.appcore").directive("ngSpinnerBar",["$rootScope","$location","$localStorage","$sessionStorage","$state","SYSNAME","LOGINURL",function(e,a,t,o,n,r,l){return{link:function(n,i,c){i.addClass("hide"),e.$on("$stateChangeStart",function(){console.log("$stateChangeStart"),a.absUrl()!=l&&(t.authenticationToken||o.authenticationToken||(window.location=a.protocol()+"://"+a.host()+":"+a.port()+"/"+r+"/"+l)),i.removeClass("hide")}),e.$on("$stateChangeSuccess",function(){console.log("$stateChangeSuccess"),setTimeout(function(){matchMenu(function(){i.addClass("hide"),$("body").removeClass("page-on-load")})},1e3)}),e.$on("$stateNotFound",function(){i.addClass("hide")}),e.$on("$stateChangeError",function(){i.addClass("hide")})}}}]),angular.module("hm.appcore").directive("a",function(){return{restrict:"E",link:function(e,a,t){(t.ngClick||""===t.href||"#"===t.href)&&a.on("click",function(e){e.preventDefault()})}}}),angular.module("hm.appcore").directive("dropdownMenuHover",function(){return{link:function(e,a){a.dropdownHover()}}}),angular.module("hm.appcore").directive("ngPageUtil",["$compile",function(e){function a(t,o){o.empty();var n=t.page,r=t.total;if(null!=r){var l=t.size,i=Math.ceil(r/l),c="<p>当前显示<span>"+((n-1)*l+1)+"到"+(n*l>r?r:n*l)+"</span>条，共<span>"+r+"</span>条记录</p>";$(o[0]).append(c);var s='<li ng-class="{\'active\':page=={pageNum}}"><a ng-click="loadPage({page})">{pageStr}</a></li>',u='<li class="disabled"><a>...</a></li>',p='<li class="{disabled}"><a ng-click="loadPage({page})" aria-label="Previous"><span class="glyphicon glyphicon-triangle-left" aria-hidden="true"></span></a></li>',d='<li class="{disabled}"><a ng-click="loadPage({page})" aria-label="Next"><span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span></a></li>',g="";if(g+=1==n?p.replace("{disabled}","disabled").replace("{page}",1):p.replace("{disabled}","").replace("{page}",n-1),i<=7)for(var m=0;m<i;m++)g+=s.replace("{pageNum}",m+1).replace("{page}",m+1).replace("{pageStr}",m+1);else g+=s.replace("{pageNum}",1).replace("{page}",1).replace("{pageStr}",1),n<=4?(g+=s.replace("{pageNum}",2).replace("{page}",2).replace("{pageStr}",2),g+=s.replace("{pageNum}",3).replace("{page}",3).replace("{pageStr}",3),g+=s.replace("{pageNum}",4).replace("{page}",4).replace("{pageStr}",4),g+=s.replace("{pageNum}",5).replace("{page}",5).replace("{pageStr}",5),g+=u):n>=i-3?(g+=u,g+=s.replace("{pageNum}",i-4).replace("{page}",i-4).replace("{pageStr}",i-4),g+=s.replace("{pageNum}",i-3).replace("{page}",i-3).replace("{pageStr}",i-3),g+=s.replace("{pageNum}",i-2).replace("{page}",i-2).replace("{pageStr}",i-2),g+=s.replace("{pageNum}",i-1).replace("{page}",i-1).replace("{pageStr}",i-1)):(g+=u,g+=s.replace("{pageNum}",n-1).replace("{page}",n-1).replace("{pageStr}",n-1),g+=s.replace("{pageNum}",n).replace("{page}",n).replace("{pageStr}",n),g+=s.replace("{pageNum}",n+1).replace("{page}",n+1).replace("{pageStr}",n+1),g+=u),g+=s.replace("{pageNum}",i).replace("{page}",i).replace("{pageStr}",i);g+=n==i?d.replace("{disabled}","disabled").replace("{page}",i):d.replace("{disabled}","").replace("{page}",n+1),$(o[0]).append(e('<ul  class="pagination">'+g+"</ul>")(t)),o.find("li").on("click",function(){$(this).hasClass("disabled")||a(t,o)})}else setTimeout(function(){a(t,o)},100)}var t=[];return{link:function(e,o,n){a(e,o),t.push(e.$watch("total",function(e,t,n){a(n,o)})),e.$on("$destroy",function(){for(;t.length;)t.shift()()})}}}]),angular.module("hm.appcore").directive("ngGoBack",["$window",function(e){return{link:function(a,t,o){t.on("click",function(a){e.history.back(),a.stopPropagation()})}}}]),angular.module("hm.appcore").factory("hmState",["$state",function(e){return{go:function(a,t,o){$(".main-view").removeClass("active"),e.go(a,t),$(".child-view").addClass("active"),"function"==typeof o&&o()},back:function(e){$(".child-view").removeClass("active"),$(".main-view").addClass("active"),window.history.back(),"function"==typeof e&&e()}}}]),angular.module("hm.appcore").directive("hmStateGoBack",["$window",function(e){return{link:function(a,t,o){t.on("click",function(a){$(".child-view").removeClass("active"),$(".main-view").addClass("active"),e.history.back(),a.stopPropagation()})}}}]),angular.module("hm.appcore").directive("hmFormPoints",function(){return{require:"?ngModel",restrict:"A",scope:{ngModel:"="},link:function(e,a,t,o){o.$render=function(){a.val(o.$viewValue||"");var e=parseInt(o.$viewValue);i.find("li").slice(0,e).addClass("active")};for(var n=null==t.total?5:parseInt(t.total),r="",l=0;l<n;l++)r+='<li class="point-item"></li>';var i=angular.element('<ul class="point-bar">'+r+"</ul>");i.insertAfter(a),a.addClass("hide"),i.find("li").hover(function(){$(this).addClass("hover"),$(this).prevAll().addClass("hover")},function(){i.find("li").removeClass("hover")}),i.find("li").on("click",function(){i.find("li").removeClass("active"),$(this).addClass("active"),$(this).prevAll().addClass("active"),a.val($(this).prevAll().length+1).trigger("change")}),i.on("dblclick",function(){i.find("li").removeClass("active"),a.val(0).trigger("change")})}}}),function(){"use strict";function e(e,a,t,o,n,r){function l(a){e({method:"GET",url:r+"hmmsuser/api/tb_users/queryMenu",params:{loginId:t.userInfo.loginId,sysKey:n},data:{}}).success(function(e,n,r,l){0==e.list.length&&($(".page-spinner-bar").removeClass("hide"),$("body").addClass("page-on-load"),toastr.error("您没有权限进入该系统!","登陆失败"),delete o.authenticationToken,delete t.authenticationToken,delete t.userInfo,setTimeout(function(){window.location.reload()},2e3)),a(e.list,n,r,l)}).error(function(e,t,o,n){a(e,t,o,n)})}function i(){var t=a.defer();return e({method:"GET",url:r+"hmmsuser/api/tb_user",params:{},data:{}}).success(function(e,a,o,n){t.resolve(e)}).error(function(e,a,o,n){t.reject(e)}),t.promise}return{getSidebarInfo:function(e){null==t.userInfo?i().then(function(a){t.userInfo=a,l(e)}):l(e)},getUserInfo:i,changeMyPassword:function(t,o){var n=a.defer();return e({method:"POST",url:r+"api/account/change_my_password",params:{},data:{password:t,oldPassword:o}}).success(function(e,a,t,o){n.resolve(e)}).error(function(e,a,t,o){n.reject(e)}),n.promise}}}angular.module("hm.appcore").service("hmappService",e),e.$inject=["$http","$q","$sessionStorage","$localStorage","SYSCODE","GATEWAYURL"]}();var Layout=function(){var e=function(e,a){var t=location.hash.toLowerCase(),o=$("#jquery-accordion-menu");if("click"===e||"set"===e)a=$(a);else if("match"===e){o.find("li > a");o.find("li > a").each(function(){var e=null==$(this).attr("href")?"":$(this).attr("href").toLowerCase();e.length>1&&t.substr(1,e.length-1)==e.substr(1)&&(a=$(this))})}a&&0!=a.size()&&"javascript:;"!==a.attr("href").toLowerCase()&&"#"!==a.attr("href").toLowerCase()&&(o.find("li.active").removeClass("active"),a.parents("li").each(function(){$(this).addClass("active"),$(this).find("> a").addClass("submenu-indicator-minus"),$(this).find("ul.submenu").size()>0&&$(this).find("ul.submenu").css("display","block")}))};return{setSidebarMenuActiveLink:function(a,t){e(a,t)}}}();!function(){"use strict";angular.module("hm.appcore").config(["$httpProvider",function(e){e.interceptors.push("authInterceptor"),e.interceptors.push("authExpiredInterceptor")}])}(),function(){"use strict";function e(e,a,t,o,n,r,l){return{request:function(e){e.headers=e.headers||{};var a=o.authenticationToken||n.authenticationToken;return a?e.headers.Authorization="Bearer "+a:window.location=t.protocol()+"://"+t.host()+":"+t.port()+"/"+r+"/"+l,e}}}angular.module("hm.appcore").factory("authInterceptor",e),e.$inject=["$rootScope","$q","$location","$localStorage","$sessionStorage","SYSNAME","LOGINURL"]}(),function(){"use strict";function e(e,a,t,o,n){return{responseError:function(e){return 401===e.status&&(delete o.authenticationToken,delete n.authenticationToken,delete n.userInfo,window.location.reload()),a.reject(e)}}}angular.module("hm.appcore").factory("authExpiredInterceptor",e),e.$inject=["$rootScope","$q","$injector","$localStorage","$sessionStorage"]}();