function matchMenu(e){$("#jquery-accordion-menu").find("li").length>0?(Layout.setSidebarMenuActiveLink("match"),e()):setTimeout(function(){matchMenu(e)},100)}angular.module("hm.appcore",["ui.router","ui.bootstrap","oc.lazyLoad","ngSanitize","ngStorage","ngCookies"]),null!=hmappSystemConfig&&(angular.module("hm.appcore").constant("SYSNAME",hmappSystemConfig.SYSNAME),angular.module("hm.appcore").constant("SYSCODE",hmappSystemConfig.SYSCODE),angular.module("hm.appcore").constant("VERSION",hmappSystemConfig.VERSION),angular.module("hm.appcore").constant("GATEWAYURL",hmappSystemConfig.GATEWAYURL),angular.module("hm.appcore").constant("LOGINURL",hmappSystemConfig.LOGINURL),angular.module("hm.appcore").constant("LOGOUTURL",hmappSystemConfig.LOGOUTURL),angular.module("hm.appcore").constant("INDEXURL",hmappSystemConfig.INDEXURL)),angular.module("hm.appcore").constant("COMMONSTATE",[{name:"403",url:"/403.html",templateUrl:"hm/views/403.html",data:{pageTitle:"403 - 禁止访问: 访问被拒绝。"},controller:"",ocLazyLoad:{name:"hm.appcore",files:[]}},{name:"404",url:"/404.html",templateUrl:"hm/views/404.html",data:{pageTitle:"404 - 找不到文件或目录。"},controller:"",ocLazyLoad:{name:"hm.appcore",files:[]}},{name:"500",url:"/500.html",templateUrl:"hm/views/500.html",data:{pageTitle:"500 - 内部服务器错误。"},controller:"",ocLazyLoad:{name:"hm.appcore",files:[]}}]),angular.module("hm.appcore").controller("AppController",["$scope","$rootScope",function(e,a){e.$on("$viewContentLoaded",function(){}),console.log("AppController")}]),angular.module("hm.appcore").run(["$rootScope","$state","$ocLazyLoad","$location","auth",function(e,a,o,n,t){console.log("do run"),t.saveToken(),o.load("hm.appcore"),e.$state=a}]),function(){"use strict";angular.module("hm.appcore").config(["$ocLazyLoadProvider","globalLazyLoad",function(e,a){e.config({debug:!0,events:!0,modules:[{name:"hm.appcore",insertBefore:"#ng_load_plugins_before",files:a.concat([])}]})}]),angular.module("hm.appcore").config(["$controllerProvider",function(e){e.allowGlobals()}]),angular.module("hm.appcore").config(["$stateProvider","$urlRouterProvider","STATECONFIG","COMMONSTATE",function(e,a,o,n){null!=o&&o.length>0&&(angular.forEach(o,function(a){e.state(a.name,{url:a.url,params:a.params,templateUrl:a.templateUrl,data:a.data,controller:a.controller,resolve:{deps:["$ocLazyLoad",function(e){return e.load($.extend({serie:!0},a.ocLazyLoad))}]}})}),angular.forEach(n,function(a){e.state(a.name,{url:a.url,params:a.params,templateUrl:a.templateUrl,data:a.data,controller:a.controller,resolve:{deps:["$ocLazyLoad",function(e){return e.load($.extend({serie:!0},a.ocLazyLoad))}]}})}))}])}(),angular.module("hm.appcore").directive("ngDoLogout",["auth",function(e){return{link:function(a,o,n){o.bind("click",function(){e.doLogout()})}}}]),angular.module("hm.appcore").directive("ngSpinnerBar",["$rootScope","$location","$localStorage","auth",function(e,a,o,n){return{link:function(a,t,r){t.addClass("hide"),e.$on("$stateChangeStart",function(){console.log("$stateChangeStart"),o.authenticationToken||n.doLogin(),t.removeClass("hide")}),e.$on("$stateChangeSuccess",function(){console.log("$stateChangeSuccess"),setTimeout(function(){matchMenu(function(){t.addClass("hide"),$("body").removeClass("page-on-load")})},1e3)}),e.$on("$stateNotFound",function(){t.addClass("hide")}),e.$on("$stateChangeError",function(){t.addClass("hide")})}}}]),angular.module("hm.appcore").directive("a",function(){return{restrict:"E",link:function(e,a,o){(o.ngClick||""===o.href||"#"===o.href)&&a.on("click",function(e){e.preventDefault()})}}}),angular.module("hm.appcore").directive("dropdownMenuHover",function(){return{link:function(e,a){a.dropdownHover()}}}),angular.module("hm.appcore").directive("ngPageUtil",["$compile",function(e){function a(o,n){n.empty();var t=o.page,r=o.total;if(null!=r){var l=o.size,i=Math.ceil(r/l),c="<p>当前显示<span>"+((t-1)*l+1)+"到"+(t*l>r?r:t*l)+"</span>条，共<span>"+r+"</span>条记录</p>";$(n[0]).append(c);var s='<li ng-class="{\'active\':page=={pageNum}}"><a ng-click="loadPage({page})">{pageStr}</a></li>',u='<li class="disabled"><a>...</a></li>',p='<li class="{disabled}"><a ng-click="loadPage({page})" aria-label="Previous"><span class="glyphicon glyphicon-triangle-left" aria-hidden="true"></span></a></li>',d='<li class="{disabled}"><a ng-click="loadPage({page})" aria-label="Next"><span class="glyphicon glyphicon-triangle-right" aria-hidden="true"></span></a></li>',g="";if(g+=1==t?p.replace("{disabled}","disabled").replace("{page}",1):p.replace("{disabled}","").replace("{page}",t-1),i<=7)for(var m=0;m<i;m++)g+=s.replace("{pageNum}",m+1).replace("{page}",m+1).replace("{pageStr}",m+1);else g+=s.replace("{pageNum}",1).replace("{page}",1).replace("{pageStr}",1),t<=4?(g+=s.replace("{pageNum}",2).replace("{page}",2).replace("{pageStr}",2),g+=s.replace("{pageNum}",3).replace("{page}",3).replace("{pageStr}",3),g+=s.replace("{pageNum}",4).replace("{page}",4).replace("{pageStr}",4),g+=s.replace("{pageNum}",5).replace("{page}",5).replace("{pageStr}",5),g+=u):t>=i-3?(g+=u,g+=s.replace("{pageNum}",i-4).replace("{page}",i-4).replace("{pageStr}",i-4),g+=s.replace("{pageNum}",i-3).replace("{page}",i-3).replace("{pageStr}",i-3),g+=s.replace("{pageNum}",i-2).replace("{page}",i-2).replace("{pageStr}",i-2),g+=s.replace("{pageNum}",i-1).replace("{page}",i-1).replace("{pageStr}",i-1)):(g+=u,g+=s.replace("{pageNum}",t-1).replace("{page}",t-1).replace("{pageStr}",t-1),g+=s.replace("{pageNum}",t).replace("{page}",t).replace("{pageStr}",t),g+=s.replace("{pageNum}",t+1).replace("{page}",t+1).replace("{pageStr}",t+1),g+=u),g+=s.replace("{pageNum}",i).replace("{page}",i).replace("{pageStr}",i);g+=t==i?d.replace("{disabled}","disabled").replace("{page}",i):d.replace("{disabled}","").replace("{page}",t+1),$(n[0]).append(e('<ul  class="pagination">'+g+"</ul>")(o)),n.find("li").on("click",function(){$(this).hasClass("disabled")||a(o,n)})}else setTimeout(function(){a(o,n)},100)}var o=[];return{link:function(e,n,t){a(e,n),o.push(e.$watch("total",function(e,o,t){a(t,n)})),e.$on("$destroy",function(){for(;o.length;)o.shift()()})}}}]),angular.module("hm.appcore").directive("ngGoBack",["$window",function(e){return{link:function(a,o,n){o.on("click",function(a){e.history.back(),a.stopPropagation()})}}}]),angular.module("hm.appcore").factory("hmState",["$state",function(e){return{go:function(a,o,n){$(".main-view").removeClass("active"),e.go(a,o),$(".child-view").addClass("active"),"function"==typeof n&&n()},back:function(e){$(".child-view").removeClass("active"),$(".main-view").addClass("active"),window.history.back(),"function"==typeof e&&e()}}}]),angular.module("hm.appcore").directive("hmStateGoBack",["$window",function(e){return{link:function(a,o,n){o.on("click",function(a){$(".child-view").removeClass("active"),$(".main-view").addClass("active"),e.history.back(),a.stopPropagation()})}}}]),angular.module("hm.appcore").directive("hmFormPoints",function(){return{require:"?ngModel",restrict:"A",scope:{ngModel:"="},link:function(e,a,o,n){n.$render=function(){a.val(n.$viewValue||"");var e=parseInt(n.$viewValue);i.find("li").slice(0,e).addClass("active")};for(var t=null==o.total?5:parseInt(o.total),r="",l=0;l<t;l++)r+='<li class="point-item"></li>';var i=angular.element('<ul class="point-bar">'+r+"</ul>");i.insertAfter(a),a.addClass("hide"),i.find("li").hover(function(){$(this).addClass("hover"),$(this).prevAll().addClass("hover")},function(){i.find("li").removeClass("hover")}),i.find("li").on("click",function(){i.find("li").removeClass("active"),$(this).addClass("active"),$(this).prevAll().addClass("active"),a.val($(this).prevAll().length+1).trigger("change")}),i.on("dblclick",function(){i.find("li").removeClass("active"),a.val(0).trigger("change")})}}}),angular.module("hm.appcore").directive("hmWordNum",function(){return{require:"?ngModel",restrict:"A",scope:{ngModel:"="},link:function(e,a,o,n){function t(){null!=r&&r.remove();var e="black";a.val().length/o.hmWordNum>=1&&(e="red"),r=$('<span style="position:absolute;top:'+(a.offset().top+a.height()-20)+"px;left:"+(a.offset().left+a.width()+20)+'px"><span style="color:'+e+'">'+a.val().length+"</span>/"+o.hmWordNum+"</span>").appendTo("body")}var r;console.log(n),null!=n?n.$render=function(){a.val(n.$viewValue||""),t()}:t(),a.on("keyup",function(){t()}),a.on("resize",function(e){t(),e.stopPropagation()}),a.parents().on("resize",function(e){e.stopPropagation()}),e.$on("$destroy",function(){console.log("destroy"),r.remove()})}}}),function(){"use strict";function e(e,a,o,n,t,r){function l(a){e({method:"GET",url:r+"hmmsuser/api/tb_users/queryMenu",params:{loginId:o.userInfo.loginId,sysKey:t},data:{}}).success(function(e,o,t,r){0==e.list.length&&($(".page-spinner-bar").removeClass("hide"),$("body").addClass("page-on-load"),toastr.error("您没有权限进入该系统!","登陆失败"),setTimeout(function(){n.doLogout()},2e3)),a(e.list,o,t,r)}).error(function(e,o,n,t){a(e,o,n,t)})}function i(){var o=a.defer();return e({method:"GET",url:r+"hmmsuser/api/tb_user",params:{},data:{}}).success(function(e,a,n,t){o.resolve(e)}).error(function(e,a,n,t){o.reject(e)}),o.promise}return{getSidebarInfo:function(e){null==o.userInfo?i().then(function(a){o.userInfo=a,l(e)}):l(e)},getUserInfo:i,changeMyPassword:function(o,n){var t=a.defer();return e({method:"POST",url:r+"api/account/change_my_password",params:{},data:{password:o,oldPassword:n}}).success(function(e,a,o,n){t.resolve(e)}).error(function(e,a,o,n){t.reject(e)}),t.promise}}}angular.module("hm.appcore").service("hmappService",e),e.$inject=["$http","$q","$sessionStorage","auth","SYSCODE","GATEWAYURL"]}();var Layout=function(){var e=function(e,a){var o=location.hash.toLowerCase(),n=$("#jquery-accordion-menu");if("click"===e||"set"===e)a=$(a);else if("match"===e){n.find("li > a");n.find("li > a").each(function(){var e=null==$(this).attr("href")?"":$(this).attr("href").toLowerCase();e.length>1&&o.substr(1,e.length-1)==e.substr(1)&&(a=$(this))})}a&&0!=a.size()&&"javascript:;"!==a.attr("href").toLowerCase()&&"#"!==a.attr("href").toLowerCase()&&(n.find("li.active").removeClass("active"),a.parents("li").each(function(){$(this).addClass("active"),$(this).find("> a").addClass("submenu-indicator-minus"),$(this).find("ul.submenu").size()>0&&$(this).find("ul.submenu").css("display","block")}))};return{setSidebarMenuActiveLink:function(a,o){e(a,o)}}}();angular.module("hm.appcore").factory("auth",["$q","$http","$location","$localStorage","$sessionStorage","GATEWAYURL","LOGINURL","LOGOUTURL","SYSNAME",function(e,a,o,n,t,r,l,i,c){function s(){return encodeURIComponent(o.protocol()+"://"+o.host()+":"+o.port()+"/"+c+"/#")}return{saveToken:function(){console.log("loginWithUrlToken");var e=o.search().token;console.log("token",e),null!=e&&""!=e&&(n.authenticationToken=e)},doLogout:function(){var e="",a=s();null!=a&&""!=a&&(e="?url="+a),n.$reset(),t.$reset(),window.location=i+e},doLogin:function(){console.log("doLogin");var e="",a=s();null!=a&&""!=a&&(e="?url="+a),n.$reset(),t.$reset(),console.log("LOGINURL+params",l+e),window.location=l+e}}}]),function(){"use strict";angular.module("hm.appcore").config(["$httpProvider",function(e){e.interceptors.push("authInterceptor"),e.interceptors.push("authExpiredInterceptor")}])}(),function(){"use strict";function e(e,a,o,n,t,r){function l(){console.log("doLogin");var e="",n=i();null!=n&&""!=n&&(e="?url="+n),a.$reset(),o.$reset(),console.log("LOGINURL+params",t+e),window.location=t+e}function i(){return encodeURIComponent(e.protocol()+"://"+e.host()+":"+e.port()+"/"+n+"/#")}return{request:function(e){var o=[r+"api/authenticate"],n=!1;switch(e.method){case"GET":n=o.indexOf(e.url)>=0}if(!n){e.headers=e.headers||{},console.log("do auth interceptor");var t=a.authenticationToken;t?e.headers.Authorization="Bearer "+t:l()}return e}}}angular.module("hm.appcore").factory("authInterceptor",e),e.$inject=["$location","$localStorage","$sessionStorage","SYSNAME","LOGINURL","GATEWAYURL"]}(),function(){"use strict";function e(e,a,o,n,t,r){function l(){var e="",a=i();null!=a&&""!=a&&(e="?url="+a),o.$reset(),n.$reset(),window.location=t+e}function i(){return encodeURIComponent(a.protocol()+"://"+a.host()+":"+a.port()+"/"+r+"/#")}return{responseError:function(a){return 401===a.status&&l(),e.reject(a)}}}angular.module("hm.appcore").factory("authExpiredInterceptor",e),e.$inject=["$q","$location","$localStorage","$sessionStorage","LOGOUTURL","SYSNAME"]}();